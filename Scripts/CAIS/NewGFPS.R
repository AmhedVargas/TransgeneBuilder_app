##set working directory
setwd("/home/velazqam/Documents/Projects/CodonOptimization/GFPs_iterator")

###Replicate Bringmans values
CalculateCAI = function(x,tabibi,cai,list){
  x=toupper(x)
  if(!is.character(x)){return(c())}
  vecseq=unlist(strsplit(x,""))
  if((length(vecseq) %% 3) != 0){return(c())}
  if(cai == 5 ){cai=11}
  CAIvalues=c()
  for(pos in seq(1,length(vecseq),by=3)){
    am=tabibi[paste(c(vecseq[pos:(pos+2)]),sep="",collapse=""),"Amino"]
    tabs=list[[as.character(am)]]
    CAIvalues=append(CAIvalues,tabs[paste(c(vecseq[pos:(pos+2)]),sep="",collapse=""),cai]/max(tabs[,cai]))
  }
  return(gm_mean(CAIvalues))
}


###Run 3 times algorithm
A="ATGCCCAAAAAGAAACGGAAAGTTTCTAAGGGCGAAGAACTTTTCACAGGAGTGGTTCCTATCCTCGTCGAACTGGACGGAGATGTGAACGGACACAAGTTCAGCGTGAGTGGGGAAGGTGAAGGAGATGCCACGTACGGCAAATTGACACTCAAGTTCATCTGCACCACCGGCAAACTTCCAGTTCCTTGGCCAACTCTTGTTACTACATTCTGCTATGGAGTTCAATGCTTTTCGCGCTACCCGGACCATATGAAAAGACACGACTTTTTTAAAAGTGCCATGCCAGAAGGATACGTGCAGGAACGAACCATCTTCTTCAAGGATGACGGAAACTATAAGACCCGTGCTGAAGTTAAGTTCGAAGGAGACACTCTTGTCAACCGAATCGAGTTAAAGGGAATCGATTTCAAGGAGGATGGCAACATTCTAGGTCATAAGCTCGAGTATAACTACAACAGTCATAACGTCTATATCATGGCTGACAAGCAGAAGAATGGCATTAAGGTCAACTTTAAGATTCGTCACAATATTGAAGACGGATCTGTCCAATTGGCAGATCACTACCAACAAAACACCCCAATTGGAGACGGACCAGTTCTGCTACCTGATAACCATTATTTGAGCACTCAATCTGCCCTCTCAAAGGATCCAAACGAAAAGCGTGACCACATGGTCCTCTTGGAATTCGTAACGGCAGCCGGAATCACCCATGGAATGGACGAATTGTACAAGTCCCGCCGTCGTAAGGCCAACCCAACAAAGCTTTCTGAAAACGCGAAGAAACTGGCCAAAGAGGTAGAGAACTAA"
B="ATGCCCAAAAAGAAGCGGAAGGTTTCTAAGGGCGAAGAATTGTTCACGGGAGTAGTCCCAATCTTAGTCGAGCTTGACGGTGACGTTAATGGCCACAAGTTTTCCGTGTCTGGAGAAGGAGAAGGCGACGCTACCTACGGTAAGCTGACCCTGAAGTTCATTTGCACTACTGGCAAGTTACCAGTACCATGGCCGACCCTGGTGACAACATTTTGCTACGGGGTTCAATGCTTCTCCAGATATCCGGACCATATGAAAAGACACGACTTTTTTAAATCCGCCATGCCAGAGGGTTACGTTCAAGAACGTACCATTTTTTTTAAGGACGATGGTAACTACAAGACACGTGCGGAGGTTAAATTTGAAGGCGATACTCTCGTGAACCGTATTGAGCTCAAGGGAATCGATTTCAAGGAAGATGGAAACATTTTGGGCCACAAGCTTGAATATAATTATAATAGTCATAATGTCTACATTATGGCCGACAAACAAAAAAACGGTATTAAGGTTAACTTCAAGATTCGCCACAATATCGAAGATGGATCTGTCCAACTTGCTGACCACTACCAACAAAATACTCCAATTGGAGATGGACCGGTTTTGCTTCCAGATAACCACTACCTTTCCACTCAGTCTGCCCTCTCTAAGGATCCGAATGAAAAACGTGACCATATGGTTCTTTTGGAGTTCGTTACCGCAGCAGGAATTACTCACGGAATGGATGAACTGTACAAGTCTCGTAGACGCAAGGCTAACCCGACAAAACTCTCGGAGAACGCAAAGAAGCTCGCTAAGGAAGTCGAAAATTAA"
C="ATGCCCAAGAAGAAGCGTAAGGTCAGTAAAGGAGAAGAGTTATTCACGGGTGTGGTCCCTATACTCGTCGAACTTGATGGTGACGTAAATGGCCACAAGTTCTCAGTGTCGGGAGAGGGAGAAGGAGATGCAACTTACGGTAAACTCACTTTGAAGTTCATCTGCACAACGGGAAAGTTGCCTGTACCATGGCCAACATTAGTTACGACTTTCTGTTATGGAGTCCAGTGTTTCTCGCGATATCCAGACCATATGAAGAGACACGATTTCTTCAAGTCTGCTATGCCAGAAGGATATGTCCAGGAGCGTACCATCTTTTTTAAAGACGACGGTAACTATAAAACCAGAGCGGAAGTTAAGTTCGAAGGCGACACTCTTGTGAATCGTATTGAACTCAAAGGAATCGATTTCAAGGAAGATGGAAATATTCTCGGTCACAAGCTTGAGTACAACTACAATTCGCACAATGTGTATATCATGGCTGACAAGCAGAAAAACGGTATCAAGGTCAATTTCAAGATCCGCCACAACATTGAGGACGGATCAGTGCAACTTGCCGATCATTATCAACAGAATACCCCTATCGGAGATGGTCCGGTGTTGCTTCCAGATAATCATTACCTGTCTACACAGAGTGCACTCAGTAAGGACCCAAACGAGAAGCGCGACCATATGGTTCTCCTTGAGTTTGTTACTGCCGCTGGAATTACTCATGGAATGGACGAGCTTTATAAGTCACGTCGTAGAAAGGCTAATCCAACTAAGCTCTCAGAGAATGCGAAAAAGCTTGCGAAAGAGGTTGAGAATTAG"

CAp9 = "ATGCCCAAAAAGAAACGGAAAGTTTCTAAGGGCGAAGAACTCTTCACCGGAGTCGTCCCAATCCTCGTCGAGCTCGACGGAGACGTCAACGGACACAAGTTCTCCGTCTCCGGAGAGGGAGAGGGAGACGCCACCTACGGAAAGCTCACCCTCAAGTTCATCTGCACCACCGGAAAGCTCCCAGTCCCATGGCCAACCCTCGTCACCACCTTCTGCTACGGAGTCCAATGCTTCTCCCGTTACCCAGACCACATGAAGCGTCACGACTTCTTCAAGTCCGCCATGCCAGAGGGATACGTCCAAGAGCGTACCATCTTCTTCAAGGACGACGGAAACTACAAGACCCGTGCCGAGGTCAAGTTCGAGGGAGACACCCTCGTCAACCGTATCGAGCTCAAGGGAATCGACTTCAAGGAGGACGGAAACATCCTCGGACACAAGCTCGAGTACAACTACAACTCCCACAACGTCTACATCATGGCCGACAAGCAAAAGAACGGAATCAAGGTCAACTTCAAGATCCGTCACAACATCGAGGACGGATCCGTCCAACTCGCCGACCACTACCAACAAAACACCCCAATCGGAGACGGACCAGTCCTCCTCCCAGACAACCACTACCTCTCCACCCAATCCGCCCTCTCCAAGGACCCAAACGAGAAGCGTGACCACATGGTCCTCCTCGAGTTCGTCACCGCCGCCGGAATCACCCACGGAATGGACGAGCTCTACAAGTCCCGTCGTCGTAAGGCCAACCCAACCAAGCTCTCCGAGAACGCCAAGAAGCTCGCCAAGGAGGTCGAGAACTAA"

CAp7 = "ATGCCCAAAAAGAAACGGAAAGTTTCTAAGGGCGAAGAACTTTTCACTGGAGTCGTCCCAATCCTCGTCGAACTCGACGGAGACGTCAACGGACACAAATTCTCCGTCTCCGGAGAGGGAGAGGGAGATGCCACTTACGGAAAGCTCACCCTCAAATTCATCTGCACTACGGGAAAGCTCCCTGTCCCATGGCCAACCCTCGTCACCACCTTCTGCTACGGAGTCCAATGCTTCTCTCGGTACCCAGACCACATGAAGCGTCATGACTTCTTTAAGTCCGCCATGCCAGAGGGATACGTACAAGAGAGGACCATCTTCTTCAAGGACGACGGAAACTACAAGACCCGTGCCGAGGTGAAGTTCGAGGGAGACACCCTTGTCAACCGTATCGAGCTAAAGGGAATTGACTTCAAGGAGGACGGAAACATCCTCGGACACAAGCTCGAATATAACTACAACTCCCACAACGTCTACATCATGGCCGATAAGCAAAAGAACGGAATCAAGGTCAACTTCAAGATCCGTCACAACATTGAGGACGGATCCGTCCAACTCGCCGATCACTACCAACAAAACACCCCAATCGGAGACGGTCCTGTCCTCCTCCCAGACAACCACTACCTCTCCACCCAAAGCGCCTTGTCCAAGGACCCAAACGAGAAGCGTGATCACATGGTCCTCCTCGAGTTCGTAACCGCCGCCGGAATCACCCACGGTATGGATGAGCTCTACAAGTCCCGTCGTCGTAAGGCCAACCCAACTAAGTTGTCCGAGAACGCCAAGAAGCTCGCCAAGGAGGTGGAGAATTAA"

CAp5 = "ATGCCCAAAAAGAAACGGAAAGTTTCTAAGGGCGAAGAACTTTTTACTGGAGTCGTCCCAATTCTTGTCGAACTCGATGGAGATGTCAACGGACACAAATTCTCCGTTTCCGGAGAAGGAGAGGGTGATGCCACTTACGGAAAGCTCACCCTCAAATTCATTTGCACTACGGGAAAGCTCCCTGTACCATGGCCAACCCTCGTCACCACTTTCTGCTACGGAGTTCAATGTTTCTCTCGGTACCCAGATCACATGAAGAGACATGACTTCTTTAAATCGGCCATGCCAGAGGGATACGTACAAGAGAGGACCATCTTTTTCAAGGACGACGGAAACTACAAGACTCGTGCCGAAGTGAAGTTCGAGGGAGATACCCTTGTCAACCGGATCGAGCTAAAGGGAATTGACTTCAAGGAGGATGGAAATATTCTCGGACACAAACTCGAATATAACTACAACTCGCACAATGTCTACATTATGGCCGATAAGCAAAAGAACGGAATCAAGGTCAATTTCAAGATCCGACACAACATTGAGGACGGAAGTGTCCAATTGGCTGATCACTATCAACAAAATACCCCAATAGGAGACGGTCCTGTCTTGCTCCCTGACAACCACTATCTCTCCACTCAAAGCGCCTTGTCCAAGGATCCAAACGAGAAACGTGATCACATGGTTCTCCTTGAGTTCGTAACCGCCGCTGGAATCACTCACGGTATGGATGAGCTCTATAAGTCTCGTCGGCGTAAGGCCAACCCAACTAAGTTGTCCGAGAATGCCAAAAAGCTCGCGAAGGAGGTGGAGAATTAA"

CAp3 = "ATGCCCAAAAAGAAACGGAAAGTTTCTAAGGGCGAAGAACTTTTTACTGGAGTTGTCCCAATTCTTGTCGAACTTGATGGGGATGTCAACGGACACAAATTCTCGGTTTCCGGAGAAGGAGAAGGTGATGCTACTTACGGAAAGCTTACCCTCAAATTTATTTGTACGACGGGTAAGCTCCCTGTACCATGGCCAACCCTCGTCACCACTTTTTGCTATGGAGTTCAATGTTTCTCTCGGTATCCAGATCACATGAAGAGACATGATTTTTTTAAATCGGCCATGCCAGAGGGATATGTACAGGAGAGGACTATCTTTTTTAAGGATGACGGAAACTACAAGACTCGAGCCGAAGTGAAGTTTGAGGGCGATACACTTGTTAACCGGATTGAGCTAAAGGGAATTGATTTTAAGGAGGATGGAAATATTCTAGGACACAAACTTGAATATAATTACAACAGTCACAATGTCTACATTATGGCGGATAAGCAAAAGAACGGAATAAAGGTCAATTTCAAGATTCGACATAACATTGAGGATGGAAGTGTACAATTGGCTGATCATTATCAACAGAATACTCCAATAGGGGACGGTCCTGTTTTGCTACCTGATAACCACTATTTGAGTACTCAAAGCGCTTTGAGTAAGGATCCAAACGAAAAACGCGATCATATGGTTCTCCTTGAGTTCGTAACGGCCGCTGGGATCACTCACGGTATGGATGAACTCTATAAATCTCGGCGGCGTAAGGCCAACCCCACTAAGTTGAGCGAGAATGCAAAAAAGCTTGCGAAGGAAGTGGAGAATTAA"

CAp1 = "ATGCCCAAAAAGAAACGGAAAGTTTCTAAGGGCGAAGAACTATTTACGGGGGTTGTACCCATTCTAGTAGAACTTGATGGGGATGTAAATGGGCACAAATTTAGTGTTAGTGGGGAAGGAGAAGGGGATGCGACGTACGGGAAACTTACGCTAAAATTTATTTGTACGACGGGGAAGCTACCCGTACCATGGCCCACCCTCGTAACGACTTTTTGTTATGGGGTACAATGTTTTAGTCGGTATCCAGATCATATGAAAAGACATGATTTTTTTAAAAGTGCCATGCCCGAAGGATATGTACAGGAAAGGACGATATTTTTTAAGGATGATGGGAATTACAAAACGCGAGCGGAAGTAAAGTTTGAAGGCGATACGCTAGTTAATCGGATAGAGCTAAAAGGGATTGATTTTAAAGAAGATGGGAATATTCTAGGGCACAAACTAGAATATAATTATAACAGTCATAATGTATATATTATGGCGGATAAGCAAAAAAATGGAATAAAAGTAAATTTTAAGATACGGCATAACATAGAAGATGGAAGTGTACAGTTGGCGGATCATTATCAGCAGAATACTCCCATAGGGGATGGTCCCGTATTGCTACCCGATAATCATTATTTGAGTACGCAAAGTGCGTTGAGTAAAGATCCAAATGAAAAACGGGATCATATGGTTCTACTAGAGTTTGTAACGGCGGCTGGGATAACGCATGGTATGGATGAACTATATAAAAGTCGGCGGCGTAAAGCGAACCCCACGAAGCTAAGTGAGAATGCGAAAAAACTTGCGAAAGAAGTAGAGAATTAA"

nseqs=c(A, B, C, CAp9, CAp7, CAp5, CAp3, CAp1)

intloc=c(82,247,399)

###Copy codons from:
Secu="ATGCCCAAAAAGAAACGGAAAGTTTCTAAGGGCGAAGAACTTTTTACTGGAGTTGTCCCAATTCTTGTCGAACTTGATGGAGATGTCAACGGACACAAATTCTCGGTTTCCGGAGAAGGAGAGGGTGATGCTACTTACGGAAAGCTTACCCTCAAATTTATTTGTACTACGGGTAAGCTCCCTGTACCATGGCCAACCCTCGTCACCACTTTCTGCTATGGAGTTCAATGTTTCTCTCGGTATCCAGATCACATGAAGAGACATGACTTTTTTAAATCGGCCATGCCAGAGGGATACGTACAGGAGAGGACTATCTTTTTTAAGGACGACGGAAACTACAAGACTCGAGCCGAAGTGAAGTTCGAGGGCGATACACTTGTTAACCGGATTGAGCTAAAGGGAATTGATTTCAAGGAGGATGGAAATATTCTGGGACACAAACTTGAATATAATTACAACTCGCACAATGTCTACATTATGGCTGATAAGCAAAAGAACGGAATTAAGGTCAATTTCAAGATTCGACATAACATTGAGGATGGAAGTGTCCAATTGGCTGATCATTATCAACAGAATACTCCAATAGGGGACGGTCCTGTTTTGTTGCCTGATAACCACTATTTGTCCACTCAAAGCGCTTTGTCAAAGGATCCAAACGAAAAACGCGATCATATGGTTCTCCTTGAGTTCGTAACGGCCGCTGGAATCACTCACGGTATGGATGAACTCTATAAATCTCGGCGGCGTAAGGCCAACCCTACTAAGTTGAGCGAGAATGCAAAAAAGCTTGCGAAGGAAGTGGAGAATTGA"

# +- 1aa closest to reading frame

stt=(intloc-(intloc %% 3)) - 2
edd=(intloc-(intloc %% 3)) + 3
bps=c()
for(i in 1:length(stt)){bps=append(bps,c(stt[i]:edd[i]))}


Secu=unlist(strsplit(Secu,""))

nSeqs=c()
for(seq in nseqs){
  seq=unlist(strsplit(seq,""))
  seq[bps]=Secu[bps]
  nSeqs=append(nSeqs,paste(seq,collapse="",sep=""))
}

##Redo tables
caiss <- data.frame(ca1 = rep(NA,length(nSeqs)),ca2 = rep(NA,length(nSeqs)),ca3 = rep(NA,length(nSeqs)),ca4 = rep(NA,length(nSeqs)),ca5 = rep(NA,length(nSeqs)))

for(i in 1:length(nSeqs)){
  caiss[i,]=c(CalculateCAI(nSeqs[i],CAIS,1,AAtoCodF),CalculateCAI(nSeqs[i],CAIS,2,AAtoCodF),CalculateCAI(nSeqs[i],CAIS,3,AAtoCodF),CalculateCAI(nSeqs[i],CAIS,4,AAtoCodF),CalculateCAI(nSeqs[i],CAIS,5,AAtoCodF)) 
}


nbpi <- data.frame(pi3 = rep(NA,length(nSeqs)),pi4 = rep(NA,length(nSeqs)),pi5 = rep(NA,length(nSeqs)))

for(i in 1:length(nSeqs)){
  nbpi[i,]=c(length(unique(Strfindpies(nSeqs[i],Pies,3))), length(unique(Strfindpies(nSeqs[i],Pies,4))), length(unique(Strfindpies(nSeqs[i],Pies,5)))) 
}



data=cbind(caiss,nbpi)

writeLines(nSeqs,"GFPs_CAI.fasta")










write.table(data, "Values_CAI.tsv",sep="\t", row.names=F, col.names=F)

### Read new values
SGFPs = read.table("GFP_CAI.tsv", sep="\t", header=F,stringsAsFactors=F)

colnames(SGFPs) =c("Sequence","GLO_Score","GLO_LowestScore","GLO_LowestWordScore","CAI_Ubiquitous","CAI_Germline","CAI_Neurons","CAI_Somatic","CAI_1","TargetPies_3MM","TargetPies_4MM","TargetPies_5MM")

hengpi=c(3,2,7,1,1,6,9,13)
hengtosc=c(2,3,3.5,0,0,3,8,17)

###add data then introns then its done
#rps-5
#uno="gtttgtatttcgtatttggttaaaaattgcatttaaaaaatattgataaaaatatttccaaaaagagtaaaacaaaaaattaaattaatttttacag"
#dos="gtatatcattgattaaatgtagaaattttattttaccacgtttctattcag"
#tres="gtatattaattttcctggtgattcgtttaatcatttagttctttttag"
uno="gtgagttttattatcgattttcgggattttctacttgtaattaccttttgtttttaataagttgcttttttccag"
dos="gtaggttttcagtttcaatttttgttgcaactacctcaactctatgttttcag"
tres="gtaaatttttcaagcttctaaattccaaaataaaccattttaatttcttaattccag"

ffgg=cbind(SGFPs,hengpi,hengtosc)
colnames(ffgg)[(ncol(ffgg)-1):ncol(ffgg)]=c("HengsPis","HengTotalScores")

nnggseqs=c()
for(seq in ffgg$Sequence){
  seq=unlist(strsplit(seq,""))
  nnggseqs=append(nnggseqs,paste(paste(seq[1:intloc[1]],sep="",collapse=""),uno,paste(seq[(intloc[1]+1):intloc[2]],sep="",collapse=""),dos,paste(seq[(intloc[2]+1):intloc[3]],sep="",collapse=""),tres,paste(seq[(intloc[3]+1):length(seq)],sep="",collapse=""),collapse="",sep=""))
}

ffgg$Sequence=nnggseqs

write.table(ffgg,"CAI_GFPs_vals.tsv",sep="\t",col.names=T,row.names=F, quote=F)



